/*
 
jSignature v2 "2015-11-16T23:03" "commit ID dd0bbf55d474953bf4b76899885364c138f48baa"
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php> 


Simplify.js BSD 
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 jSignature's Undo Button and undo functionality plugin


jSignature v2 jSignature's custom "base30" format export and import plugins.


jSignature v2 SVG export plugin.

*/
(function(){function q(b){var a,c=b.css("color"),d;b=b[0];for(var k=!1;b&&!d&&!k;){try{a=$(b).css("background-color")}catch(e){a="transparent"}"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(d=a);k=b.body;b=b.parentNode}b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/;var k=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,g;a=void 0;(a=c.match(b))?g={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=c.match(k))&&(g={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)});var C;
d?(a=void 0,(a=d.match(b))?C={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=d.match(k))&&(C={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)})):C=g?127<Math.max.apply(null,[g.r,g.g,g.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};a=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+")"};g&&C?(b=Math.max.apply(null,[g.r,g.g,g.b]),g=Math.max.apply(null,[C.r,C.g,C.b]),g=Math.round(g+-.75*(g-b)),g={r:g,g:g,b:g}):g?(g=Math.max.apply(null,[g.r,g.g,g.b]),b=1,127<g&&
(b=-1),g=Math.round(g+96*b),g={r:g,g:g,b:g}):g={r:191,g:191,b:191};return{color:c,"background-color":C?a(C):d,"decor-color":a(g)}}function l(b,a){this.x=b;this.y=a;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var c=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===
this.x)this._length=a,this.y=a*c(this.y);else if(0===this.y)this._length=a,this.x=a*c(this.x);else{var b=Math.abs(this.y/this.x),g=Math.sqrt(Math.pow(a,2)/(1+Math.pow(b,2))),b=b*g;this._length=a;this.x=g*c(this.x);this.y=b*c(this.y)}return this};this.angleTo=function(a){var b=this.getLength()*a.getLength();return 0===b?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/b,-1),1))/Math.PI}}function h(b,a){this.x=b;this.y=a;this.getVectorToCoordinates=function(a,b){return new l(a-this.x,b-this.y)};
this.getVectorFromCoordinates=function(a,b){return this.getVectorToCoordinates(a,b).reverse()};this.getVectorToPoint=function(a){return new l(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function m(b,a,c,d,k){this.data=b;this.context=a;if(b.length)for(var g=b.length,e,t,f=0;f<g;f++){e=b[f];t=e.x.length;c.call(a,e);for(var n=1;n<t;n++)d.call(a,e,n);k.call(a,e)}this.changed=function(){};this.startStrokeFn=c;this.addToStrokeFn=d;this.endStrokeFn=
k;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==typeof a.x&&"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this.data.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var b=this._stroke,c=this.startStrokeFn,d=this.context;setTimeout(function(){c.call(d,b)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&4<Math.abs(a.x-this._lastPoint.x)+Math.abs(a.y-this._lastPoint.y)){var b=
this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var c=this._stroke,d=this.addToStrokeFn,k=this.context;setTimeout(function(){d.call(k,c,b)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(a){var b=this._stroke,c=this.endStrokeFn,d=this.context,k=this.changed;setTimeout(function(){c.call(d,b);k.call(d)},3);return!0}return null}}function r(b,a,c,d){if("ratio"===a||"%"===a.split("")[a.length-1])this.eventTokens[c+
".parentresized"]=d.subscribe(c+".parentresized",function(a,g,e,t){return function(){var t=g.width();if(t!==e){for(var f in a)a.hasOwnProperty(f)&&(d.unsubscribe(a[f]),delete a[f]);var p=b.settings;b.$parent.children().remove();for(f in b)b.hasOwnProperty(f)&&delete b[f];f=p.data;var t=1*t/e,w=[],B,h,x,l,r,m;h=0;for(x=f.length;h<x;h++){m=f[h];B={x:[],y:[]};l=0;for(r=m.x.length;l<r;l++)B.x.push(m.x[l]*t),B.y.push(m.y[l]*t);w.push(B)}p.data=w;g[c](p)}}}(this.eventTokens,this.$parent,this.$parent.width(),
1*this.canvas.width/this.canvas.height))}function y(b,a,c){var d=this.$parent=$(b);b=this.eventTokens={};this.events=new u(this);var k=$.fn.jSignature("globalEvents"),g={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,readOnly:!1,data:[]};$.extend(g,q(d));a&&$.extend(g,a);this.settings=g;for(var e in c)c.hasOwnProperty(e)&&c[e].call(this,e);this.events.publish("jSignature.initializing");
this.$controlbarUpper=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none;margin-top:-1em !important; margin-bottom:1em !important;"></div>').appendTo(d);this.isCanvasEmulator=!1;a=this.canvas=this.initializeCanvas(g);c=$(a);this.$controlbarLower=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none;margin-top:-1.5em !important; margin-bottom:1.5em !important; position: relative;"></div>').appendTo(d);
this.canvasContext=a.getContext("2d");c.data("jSignature.this",this);g.lineWidth=function(a,b){return a?a:Math.max(Math.round(b/400),2)}(g.lineWidth,a.width);this.lineCurveThreshold=3*g.lineWidth;g.cssclass&&""!=$.trim(g.cssclass)&&c.addClass(g.cssclass);this.fatFingerCompensation=0;d=function(a){var b,c,d=function(d){d=d.changedTouches&&0<d.changedTouches.length?d.changedTouches[0]:d;return new h(Math.round(d.pageX+b),Math.round(d.pageY+c)+a.fatFingerCompensation)},g=new v(750,function(){a.dataEngine.endStroke()});
this.drawEndHandler=function(b){if(!a.settings.readOnly){try{b.preventDefault()}catch(c){}g.clear();a.dataEngine.endStroke()}};this.drawStartHandler=function(k){if(!a.settings.readOnly){k.preventDefault();a.events.publish("jSignature.drawStarting");var e=$(a.canvas).offset();b=-1*e.left;c=-1*e.top;a.dataEngine.startStroke(d(k));g.kick()}};this.drawMoveHandler=function(b){a.settings.readOnly||(b.preventDefault(),a.dataEngine.inStroke&&(a.dataEngine.addToStroke(d(b)),g.kick()))};return this}.call({},
this);(function(a,b,c){var d=this.canvas,k=$(d);this.isCanvasEmulator?(k.bind("mousemove.jSignature",c),k.bind("mouseup.jSignature",a),k.bind("mousedown.jSignature",b)):(d.ontouchstart=function(k){d.onmousedown=d.onmouseup=d.onmousemove=void 0;this.fatFingerCompensation=g.minFatFingerCompensation&&-3*g.lineWidth>g.minFatFingerCompensation?-3*g.lineWidth:g.minFatFingerCompensation;b(k);d.ontouchend=a;d.ontouchstart=b;d.ontouchmove=c},d.onmousedown=function(k){d.ontouchstart=d.ontouchend=d.ontouchmove=
void 0;b(k);d.onmousedown=b;d.onmouseup=a;d.onmousemove=c},window.navigator.msPointerEnabled&&(d.onmspointerdown=b,d.onmspointerup=a,d.onmspointermove=c))}).call(this,d.drawEndHandler,d.drawStartHandler,d.drawMoveHandler);b["jSignature.windowmouseup"]=k.subscribe("jSignature.windowmouseup",d.drawEndHandler);this.events.publish("jSignature.attachingEventHandlers");r.call(this,this,g.width.toString(10),"jSignature",k);this.resetCanvas(g.data);this.events.publish("jSignature.initialized");return this}
function z(b){if(b.getContext)return!1;var a=b.ownerDocument.parentWindow,c=a.FlashCanvas?b.ownerDocument.parentWindow.FlashCanvas:"undefined"===typeof FlashCanvas?void 0:FlashCanvas;if(c){b=c.initElement(b);c=1;a&&a.screen&&a.screen.deviceXDPI&&a.screen.logicalXDPI&&(c=1*a.screen.deviceXDPI/a.screen.logicalXDPI);if(1!==c)try{$(b).children("object").get(0).resize(Math.ceil(b.width*c),Math.ceil(b.height*c)),b.getContext("2d").scale(c,c)}catch(d){}return!0}throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");
}var v=function(b,a){var c;this.kick=function(){clearTimeout(c);c=setTimeout(a,b)};this.clear=function(){clearTimeout(c)};return this},u=function(b){this.topics={};this.context=b?b:this;this.publish=function(a,b,d,k){if(this.topics[a]){var g=this.topics[a],e=Array.prototype.slice.call(arguments,1),f=[],h=[],n,p,w,B;p=0;for(w=g.length;p<w;p++)B=g[p],n=B[0],B[1]&&(B[0]=function(){},f.push(p)),h.push(n);p=0;for(w=f.length;p<w;p++)g.splice(f[p],1);p=0;for(w=h.length;p<w;p++)h[p].apply(this.context,e)}};
this.subscribe=function(a,b,d){this.topics[a]?this.topics[a].push([b,d]):this.topics[a]=[[b,d]];return{topic:a,callback:b}};this.unsubscribe=function(a){if(this.topics[a.topic])for(var b=this.topics[a.topic],d=0,k=b.length;d<k;d++)b[d]&&b[d][0]===a.callback&&b.splice(d,1)}},A=function(b,a,c,d,k){b.beginPath();b.moveTo(a,c);b.lineTo(d,k);b.closePath();b.stroke()},E=function(b){var a=this.canvasContext,c=b.x[0];b=b.y[0];var d=this.settings.lineWidth,k=a.fillStyle;a.fillStyle=a.strokeStyle;a.fillRect(c+
d/-2,b+d/-2,d,d);a.fillStyle=k},f=function(b,a){var c=new h(b.x[a-1],b.y[a-1]),d=new h(b.x[a],b.y[a]),k=c.getVectorToPoint(d);if(1<a){var g=new h(b.x[a-2],b.y[a-2]),e=g.getVectorToPoint(c),f;if(e.getLength()>this.lineCurveThreshold){f=2<a?(new h(b.x[a-3],b.y[a-3])).getVectorToPoint(g):new l(0,0);var m=.35*e.getLength(),n=e.angleTo(f.reverse()),p=k.angleTo(e.reverse());f=(new l(f.x+e.x,f.y+e.y)).resizeTo(Math.max(.05,n)*m);var w=(new l(e.x+k.x,e.y+k.y)).reverse().resizeTo(Math.max(.05,p)*m),e=this.canvasContext,
m=g.x,p=g.y,n=c.x,B=c.y,r=g.x+f.x,g=g.y+f.y;f=c.x+w.x;w=c.y+w.y;e.beginPath();e.moveTo(m,p);e.bezierCurveTo(r,g,f,w,n,B);e.closePath();e.stroke()}}k.getLength()<=this.lineCurveThreshold&&A(this.canvasContext,c.x,c.y,d.x,d.y)},e=function(b){var a=b.x.length-1;if(0<a){var c=new h(b.x[a],b.y[a]),d=new h(b.x[a-1],b.y[a-1]),e=d.getVectorToPoint(c);if(e.getLength()>this.lineCurveThreshold)if(1<a){b=(new h(b.x[a-2],b.y[a-2])).getVectorToPoint(d);var g=(new l(b.x+e.x,b.y+e.y)).resizeTo(e.getLength()/2),e=
this.canvasContext;b=d.x;var a=d.y,f=c.x,t=c.y,m=d.x+g.x,d=d.y+g.y,g=c.x,c=c.y;e.beginPath();e.moveTo(b,a);e.bezierCurveTo(m,d,g,c,f,t);e.closePath();e.stroke()}else A(this.canvasContext,d.x,d.y,c.x,c.y)}};y.prototype.resetCanvas=function(b,a){var c=this.canvas,d=this.settings,k=this.canvasContext,g=this.isCanvasEmulator,h=c.width,t=c.height;a||k.clearRect(0,0,h+30,t+30);k.shadowColor=k.fillStyle=d["background-color"];g&&k.fillRect(0,0,h+30,t+30);k.lineWidth=Math.ceil(parseInt(d.lineWidth,10));k.lineCap=
k.lineJoin="round";if(null!=d["decor-color"]){k.strokeStyle=d["decor-color"];k.shadowOffsetX=0;k.shadowOffsetY=0;var l=Math.round(t/5);A(k,1.5*l,t-l,h-1.5*l,t-l)}k.strokeStyle=d.color;g||(k.shadowColor=k.strokeStyle,k.shadowOffsetX=.5*k.lineWidth,k.shadowOffsetY=-.6*k.lineWidth,k.shadowBlur=0);b||(b=[]);k=this.dataEngine=new m(b,this,E,f,e);d.data=b;$(c).data("jSignature.data",b).data("jSignature.settings",d);k.changed=function(a,b,c){return function(){b.publish(c+".change");a.trigger("change")}}(this.$parent,
this.events,"jSignature");k.changed();return!0};y.prototype.initializeCanvas=function(b){var a=document.createElement("canvas"),c=$(a);b.width===b.height&&"ratio"===b.height&&(b.width="100%");c.css("margin",0).css("padding",0).css("border","none").css("height","ratio"!==b.height&&b.height?b.height.toString(10):1).css("width","ratio"!==b.width&&b.width?b.width.toString(10):1).css("-ms-touch-action","none").css("background-color",b["background-color"]);c.appendTo(this.$parent);"ratio"===b.height?c.css("height",
Math.round(c.width()/b.sizeRatio)):"ratio"===b.width&&c.css("width",Math.round(c.height()*b.sizeRatio));c.addClass("jSignature");a.width=c.width();a.height=c.height();this.isCanvasEmulator=z(a);a.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation();return!1};return a};(function(b){function a(a,b,c){var d=new Image,e=this;d.onload=function(){var a=e.getContext("2d"),b=a.shadowColor;a.shadowColor="transparent";a.drawImage(d,0,0,d.width<e.width?
d.width:e.width,d.height<e.height?d.height:e.height);a.shadowColor=b};d.src="data:"+b+","+a}function c(a,b){this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").resetCanvas(a,b);return this}function d(a,b){if(void 0===b&&"string"===typeof a&&"data:"===a.substr(0,5)&&(b=a.slice(5).split(",")[0],a=a.slice(6+b.length),b===a))return;var c=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));if(h.hasOwnProperty(b))0!==c.length&&h[b].call(c[0],a,b,
function(a){return function(){return a.resetCanvas.apply(a,arguments)}}(c.data("jSignature.this")));else throw Error("jSignature is unable to find import plugin with for format '"+String(b)+"'");return this}var e=new u;(function(a,b,c,d){var e,g=function(){a.publish(b+".parentresized")};c(d).bind("resize."+b,function(){e&&clearTimeout(e);e=setTimeout(g,500)}).bind("mouseup."+b,function(c){a.publish(b+".windowmouseup")})})(e,"jSignature",$,b);var g={},f={"default":function(a){return this.toDataURL()},
"native":function(a){return a},image:function(a){a=this.toDataURL();if("string"===typeof a&&4<a.length&&"data:"===a.slice(0,5)&&-1!==a.indexOf(",")){var b=a.indexOf(",");return[a.slice(5,b),a.substr(b+1)]}return[]}},h={"native":function(a,b,c){c(a)},image:a,"image/png;base64":a,"image/jpeg;base64":a,"image/jpg;base64":a},l=function(a){var b=!1;for(a=a.parentNode;a&&!b;)b=a.body,a=a.parentNode;return!b},n={"export":f,"import":h,instance:g},p={init:function(a){return this.each(function(){l(this)||new y(this,
a,g)})},destroy:function(){return this.each(function(){if(!l(this)){var a=$(this).find("canvas").data("jSignature.this");a&&(a.$controlbarLower.remove(),a.$controlbarUpper.remove(),$(a.canvas).remove())}})},getSettings:function(){return this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").settings},isModified:function(){return null!==this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").dataEngine._stroke},updateSetting:function(a,
b,c){var d=this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this");d.settings[a]=b;d.resetCanvas(c?null:d.settings.data,!0);return d.settings[a]},clear:c,reset:c,addPlugin:function(a,b,c){n.hasOwnProperty(a)&&(n[a][b]=c);return this},listPlugins:function(a){var b=[];if(n.hasOwnProperty(a)){a=n[a];for(var c in a)a.hasOwnProperty(c)&&b.push(c)}return b},getData:function(a){var b=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));void 0===a&&(a=
"default");if(0!==b.length&&f.hasOwnProperty(a))return f[a].call(b.get(0),b.data("jSignature.data"),b.data("jSignature.settings"))},importData:d,setData:d,globalEvents:function(){return e},disable:function(){this.find("input").attr("disabled",1);this.find("canvas.jSignature").addClass("disabled").data("jSignature.this").settings.readOnly=!0},enable:function(){this.find("input").removeAttr("disabled");this.find("canvas.jSignature").removeClass("disabled").data("jSignature.this").settings.readOnly=
!1},events:function(){return this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").events}};$.fn.jSignature=function(a){if(a&&"object"!==typeof a){if("string"===typeof a&&p[a])return p[a].apply(this,Array.prototype.slice.call(arguments,1));$.error("Method "+String(a)+" does not exist on jQuery.jSignature")}else return p.init.apply(this,arguments)}})(window)})();
(function(){function q(l,h,m){l=l.call(this);(function(h,l,m){h.events.subscribe(m+".change",function(){h.dataEngine.data.length?l.show():l.hide()})})(this,l,h);(function(h,l,m){var q=m+".undo";l.bind("click",function(){h.events.publish(q)});h.events.subscribe(q,function(){var l=h.dataEngine.data;l.length&&(l.pop(),h.resetCanvas(l))})})(this,l,this.events.topics.hasOwnProperty(h+".undo")?m:h)}$.fn.jSignature("addPlugin","instance","UndoButton",function(l){this.events.subscribe("jSignature.attachingEventHandlers",
function(){if(this.settings[l]){var h=this.settings[l];"function"!==typeof h&&(h=function(){var h=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),l=h.width();h.css("left",Math.round((this.canvas.width-l)/2));l!==h.width()&&h.width(l);return h});q.call(this,h,"jSignature",l)}})})})();
(function(){for(var q={},l={},h="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),m=h.length/2,r=m-1;-1<r;r--)q[h[r]]=h[r+m],l[h[r+m]]=h[r];var y=function(e){e=e.split("");for(var b=e.length,a=1;a<b;a++)e[a]=q[e[a]];return e.join("")},z=function(e){for(var b=[],a=0,c=1,d=e.length,k,g,f=0;f<d;f++)k=Math.round(e[f]),g=k-a,a=k,0>g&&0<c?(c=-1,b.push("Z")):0<g&&0>c&&(c=1,b.push("Y")),k=Math.abs(g),k>=m?b.push(y(k.toString(m))):b.push(k.toString(m));return b.join("")},v=function(e){var b=
[];e=e.split("");for(var a=e.length,c,d=1,k=[],g=0,f=0;f<a;f++)c=e[f],c in q||"Z"===c||"Y"===c?(0!==k.length&&(k=parseInt(k.join(""),m)*d+g,b.push(k),g=k),"Z"===c?(d=-1,k=[]):"Y"===c?(d=1,k=[]):k=[c]):k.push(l[c]);b.push(parseInt(k.join(""),m)*d+g);return b},u=function(e){for(var b=[],a=e.length,c,d=0;d<a;d++)c=e[d],b.push(z(c.x)),b.push(z(c.y));return b.join("_")},A=function(e){var b=[];e=e.split("_");for(var a=e.length/2,c=0;c<a;c++)b.push({x:v(e[2*c]),y:v(e[2*c+1])});return b},E=function(e){return["image/jsignature;base30",
u(e)]},f=function(e,b,a){"string"===typeof e&&("image/jsignature;base30"===e.substring(0,23).toLowerCase()&&(e=e.substring(24)),a(A(e)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(e){e=e.fn.jSignature;e("addPlugin","export","base30",E);e("addPlugin","export","image/jsignature;base30",E);e("addPlugin","import","base30",f);e("addPlugin","import","image/jsignature;base30",f)})(this.jQuery);this.jSignatureDebug&&
(this.jSignatureDebug.base30={remapTailChars:y,compressstrokeleg:z,uncompressstrokeleg:v,compressstrokes:u,uncompressstrokes:A,charmap:q})}).call("undefined"!==typeof window?window:this);
(function(){function q(f,e){this.x=f;this.y=e;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var b=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*b(this.y);else if(0===this.y)this._length=a,this.x=a*b(this.x);else{var c=Math.abs(this.y/
this.x),d=Math.sqrt(Math.pow(a,2)/(1+Math.pow(c,2))),c=c*d;this._length=a;this.x=d*b(this.x);this.y=c*b(this.y)}return this};this.angleTo=function(a){var b=this.getLength()*a.getLength();return 0===b?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/b,-1),1))/Math.PI}}function l(f,e){this.x=f;this.y=e;this.getVectorToCoordinates=function(b,a){return new q(b-this.x,a-this.y)};this.getVectorFromCoordinates=function(b,a){return this.getVectorToCoordinates(b,a).reverse()};this.getVectorToPoint=function(b){return new q(b.x-
this.x,b.y-this.y)};this.getVectorFromPoint=function(b){return this.getVectorToPoint(b).reverse()}}function h(f,e){var b=Math.pow(10,e);return Math.round(f*b)/b}function m(f,e,b){e+=1;var a=new l(f.x[e-1],f.y[e-1]),c=new l(f.x[e],f.y[e]),c=a.getVectorToPoint(c),d=new l(f.x[e-2],f.y[e-2]),a=d.getVectorToPoint(a);return a.getLength()>b?(b=2<e?(new l(f.x[e-3],f.y[e-3])).getVectorToPoint(d):new q(0,0),f=.35*a.getLength(),d=a.angleTo(b.reverse()),e=c.angleTo(a.reverse()),b=(new q(b.x+a.x,b.y+a.y)).resizeTo(Math.max(.05,
d)*f),c=(new q(a.x+c.x,a.y+c.y)).reverse().resizeTo(Math.max(.05,e)*f),c=new q(a.x+c.x,a.y+c.y),["c",h(b.x,2),h(b.y,2),h(c.x,2),h(c.y,2),h(a.x,2),h(a.y,2)]):["l",h(a.x,2),h(a.y,2)]}function r(f,e){var b=f.x.length-1,a=new l(f.x[b],f.y[b]),c=new l(f.x[b-1],f.y[b-1]),a=c.getVectorToPoint(a);if(1<b&&a.getLength()>e){var b=(new l(f.x[b-2],f.y[b-2])).getVectorToPoint(c),c=a.angleTo(b.reverse()),d=.35*a.getLength(),b=(new q(b.x+a.x,b.y+a.y)).resizeTo(Math.max(.05,c)*d);return["c",h(b.x,2),h(b.y,2),h(a.x,
2),h(a.y,2),h(a.x,2),h(a.y,2)]}return["l",h(a.x,2),h(a.y,2)]}function y(f,e,b){e=["M",h(f.x[0]-e,2),h(f.y[0]-b,2)];b=1;for(var a=f.x.length-1;b<a;b++)e.push.apply(e,m(f,b,1));0<a?e.push.apply(e,r(f,b,1)):0===a&&e.push.apply(e,["l",1,1]);return e.join(" ")}function z(f){for(var e=[],b=[["fill",void 0,"none"],["stroke","color","#000000"],["stroke-width","lineWidth",2],["stroke-linecap",void 0,"round"],["stroke-linejoin",void 0,"round"]],a=b.length-1;0<=a;a--){var c=b[a][1],d=b[a][2];e.push(b[a][0]+
'="'+(c in f&&f[c]?f[c]:d)+'"')}return e.join(" ")}function v(f,e){var b=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],a,c=f.length,d,k=[],g=[],h=d=a=0,l=0,m=[];if(0!==c){for(a=0;a<c;a++){h=f[a];l=[];d={x:[],y:[]};for(var n=void 0,p=void 0,n=0,p=h.x.length;n<p;n++)l.push({x:h.x[n],y:h.y[n]});l=simplify(l,.7,!0);n=0;for(p=l.length;n<p;n++)d.x.push(l[n].x),d.y.push(l[n].y);m.push(d);k=k.concat(d.x);
g=g.concat(d.y)}c=Math.min.apply(null,k)-1;a=Math.max.apply(null,k)+1;k=Math.min.apply(null,g)-1;g=Math.max.apply(null,g)+1;h=0>c?0:c;l=0>k?0:k;a-=c;d=g-k}b.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+a.toString()+'" height="'+d.toString()+'">');a=0;for(c=m.length;a<c;a++)d=m[a],b.push("<path "+z(e)+' d="'+y(d,h,l)+'"/>');b.push("</svg>");return b.join("")}function u(f,e){return["image/svg+xml",v(f,e)]}function A(f,e){return["image/svg+xml;base64",E(v(f,e))]}(function(f,e){"use strict";
(typeof exports!=e+""?exports:f).simplify=function(b,a,c){a=a!==e?a*a:1;if(!c){var d=b.length,f,g=b[0],h=[g];for(c=1;c<d;c++){f=b[c];var l=f.x-g.x,m=f.y-g.y;l*l+m*m>a&&(h.push(f),g=f)}b=(g!==f&&h.push(f),h)}f=b;c=f.length;var d=new (typeof Uint8Array!=e+""?Uint8Array:Array)(c),g=0,h=c-1,n,p,q=[],r=[],A=[];for(d[g]=d[h]=1;h;){m=0;for(l=g+1;l<h;l++){n=f[l];var x=f[g],y=f[h],u=x.x,v=x.y,x=y.x-u,D=y.y-v,z=void 0;if(0!==x||0!==D)z=((n.x-u)*x+(n.y-v)*D)/(x*x+D*D),1<z?(u=y.x,v=y.y):0<z&&(u+=x*z,v+=D*z);
n=(x=n.x-u,D=n.y-v,x*x+D*D);n>m&&(p=l,m=n)}m>a&&(d[p]=1,q.push(g),r.push(p),q.push(p),r.push(h));g=q.pop();h=r.pop()}for(l=0;l<c;l++)d[l]&&A.push(f[l]);return b=A,b}})(window);if("function"!==typeof E)var E=function(f){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),b,a,c,d,k=0,g=0,h="",h=[];do b=f.charCodeAt(k++),a=f.charCodeAt(k++),c=f.charCodeAt(k++),d=b<<16|a<<8|c,b=d>>18&63,a=d>>12&63,c=d>>6&63,d&=63,h[g++]=e[b]+e[a]+e[c]+e[d];while(k<f.length);h=h.join("");
f=f.length%3;return(f?h.slice(0,f-3):h)+"===".slice(f||3)};if("undefined"===typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(f){f=f.fn.jSignature;f("addPlugin","export","svg",u);f("addPlugin","export","image/svg+xml",u);f("addPlugin","export","svgbase64",A);f("addPlugin","export","image/svg+xml;base64",A)})($)})();